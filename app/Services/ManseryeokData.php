<?php

namespace App\Services;

/**
 * 만세력 데이터 클래스
 * 절기(24절기)와 일진 계산을 위한 기준 데이터
 */
class ManseryeokData
{
    // 천간 (Heavenly Stems) - 10개
    public const HEAVENLY_STEMS = ['갑', '을', '병', '정', '무', '기', '경', '신', '임', '계'];
    public const HEAVENLY_STEMS_HANJA = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];

    // 지지 (Earthly Branches) - 12개
    public const EARTHLY_BRANCHES = ['자', '축', '인', '묘', '진', '사', '오', '미', '신', '유', '술', '해'];
    public const EARTHLY_BRANCHES_HANJA = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];

    // 오행 배속 (Five Elements mapping)
    public const STEM_ELEMENTS = [
        '갑' => 'wood', '을' => 'wood',
        '병' => 'fire', '정' => 'fire',
        '무' => 'earth', '기' => 'earth',
        '경' => 'metal', '신' => 'metal',
        '임' => 'water', '계' => 'water',
    ];

    public const BRANCH_ELEMENTS = [
        '자' => 'water', '축' => 'earth',
        '인' => 'wood', '묘' => 'wood',
        '진' => 'earth', '사' => 'fire',
        '오' => 'fire', '미' => 'earth',
        '신' => 'metal', '유' => 'metal',
        '술' => 'earth', '해' => 'water',
    ];

    // 월지 - 절기 기준 (인월=1월, 묘월=2월, ...)
    // 사주의 월은 절기 기준으로, 인월(寅月)부터 시작
    public const MONTH_BRANCHES = ['인', '묘', '진', '사', '오', '미', '신', '유', '술', '해', '자', '축'];

    // 시지 매핑 (시간대별)
    public const HOUR_BRANCHES = [
        23 => '자', 0 => '자', 1 => '축', 2 => '축', 3 => '인', 4 => '인',
        5 => '묘', 6 => '묘', 7 => '진', 8 => '진', 9 => '사', 10 => '사',
        11 => '오', 12 => '오', 13 => '미', 14 => '미', 15 => '신', 16 => '신',
        17 => '유', 18 => '유', 19 => '술', 20 => '술', 21 => '해', 22 => '해',
    ];

    /**
     * 절기 데이터 (양력 날짜 기준)
     * 각 년도별 24절기 시작일
     * 월건(월주)은 절입일 기준으로 바뀜
     *
     * 절기 순서: 입춘, 우수, 경칩, 춘분, 청명, 곡우, 입하, 소만, 망종, 하지, 소서, 대서,
     *           입추, 처서, 백로, 추분, 한로, 상강, 입동, 소설, 대설, 동지, 소한, 대한
     *
     * 월주 변경 절기 (절):
     * 인월(1월) - 입춘(立春): 2/3~5
     * 묘월(2월) - 경칩(驚蟄): 3/5~7
     * 진월(3월) - 청명(淸明): 4/4~6
     * 사월(4월) - 입하(立夏): 5/5~7
     * 오월(5월) - 망종(芒種): 6/5~7
     * 미월(6월) - 소서(小暑): 7/6~8
     * 신월(7월) - 입추(立秋): 8/7~9
     * 유월(8월) - 백로(白露): 9/7~9
     * 술월(9월) - 한로(寒露): 10/8~9
     * 해월(10월) - 입동(立冬): 11/7~8
     * 자월(11월) - 대설(大雪): 12/6~8
     * 축월(12월) - 소한(小寒): 1/5~7
     */
    public const SOLAR_TERMS = [
        // 2020년
        2020 => [
            '소한' => '01-06', '대한' => '01-20',
            '입춘' => '02-04', '우수' => '02-19',
            '경칩' => '03-05', '춘분' => '03-20',
            '청명' => '04-04', '곡우' => '04-19',
            '입하' => '05-05', '소만' => '05-20',
            '망종' => '06-05', '하지' => '06-21',
            '소서' => '07-06', '대서' => '07-22',
            '입추' => '08-07', '처서' => '08-22',
            '백로' => '09-07', '추분' => '09-22',
            '한로' => '10-08', '상강' => '10-23',
            '입동' => '11-07', '소설' => '11-22',
            '대설' => '12-07', '동지' => '12-21',
        ],
        2021 => [
            '소한' => '01-05', '대한' => '01-20',
            '입춘' => '02-03', '우수' => '02-18',
            '경칩' => '03-05', '춘분' => '03-20',
            '청명' => '04-04', '곡우' => '04-20',
            '입하' => '05-05', '소만' => '05-21',
            '망종' => '06-05', '하지' => '06-21',
            '소서' => '07-07', '대서' => '07-22',
            '입추' => '08-07', '처서' => '08-23',
            '백로' => '09-07', '추분' => '09-23',
            '한로' => '10-08', '상강' => '10-23',
            '입동' => '11-07', '소설' => '11-22',
            '대설' => '12-07', '동지' => '12-21',
        ],
        2022 => [
            '소한' => '01-05', '대한' => '01-20',
            '입춘' => '02-04', '우수' => '02-19',
            '경칩' => '03-05', '춘분' => '03-20',
            '청명' => '04-05', '곡우' => '04-20',
            '입하' => '05-05', '소만' => '05-21',
            '망종' => '06-06', '하지' => '06-21',
            '소서' => '07-07', '대서' => '07-23',
            '입추' => '08-07', '처서' => '08-23',
            '백로' => '09-08', '추분' => '09-23',
            '한로' => '10-08', '상강' => '10-23',
            '입동' => '11-07', '소설' => '11-22',
            '대설' => '12-07', '동지' => '12-22',
        ],
        2023 => [
            '소한' => '01-06', '대한' => '01-20',
            '입춘' => '02-04', '우수' => '02-19',
            '경칩' => '03-06', '춘분' => '03-21',
            '청명' => '04-05', '곡우' => '04-20',
            '입하' => '05-06', '소만' => '05-21',
            '망종' => '06-06', '하지' => '06-21',
            '소서' => '07-07', '대서' => '07-23',
            '입추' => '08-08', '처서' => '08-23',
            '백로' => '09-08', '추분' => '09-23',
            '한로' => '10-08', '상강' => '10-24',
            '입동' => '11-08', '소설' => '11-22',
            '대설' => '12-07', '동지' => '12-22',
        ],
        2024 => [
            '소한' => '01-06', '대한' => '01-20',
            '입춘' => '02-04', '우수' => '02-19',
            '경칩' => '03-05', '춘분' => '03-20',
            '청명' => '04-04', '곡우' => '04-19',
            '입하' => '05-05', '소만' => '05-20',
            '망종' => '06-05', '하지' => '06-21',
            '소서' => '07-06', '대서' => '07-22',
            '입추' => '08-07', '처서' => '08-22',
            '백로' => '09-07', '추분' => '09-22',
            '한로' => '10-08', '상강' => '10-23',
            '입동' => '11-07', '소설' => '11-22',
            '대설' => '12-07', '동지' => '12-21',
        ],
        2025 => [
            '소한' => '01-05', '대한' => '01-20',
            '입춘' => '02-03', '우수' => '02-18',
            '경칩' => '03-05', '춘분' => '03-20',
            '청명' => '04-04', '곡우' => '04-20',
            '입하' => '05-05', '소만' => '05-21',
            '망종' => '06-05', '하지' => '06-21',
            '소서' => '07-07', '대서' => '07-22',
            '입추' => '08-07', '처서' => '08-23',
            '백로' => '09-07', '추분' => '09-23',
            '한로' => '10-08', '상강' => '10-23',
            '입동' => '11-07', '소설' => '11-22',
            '대설' => '12-07', '동지' => '12-21',
        ],
        2026 => [
            '소한' => '01-05', '대한' => '01-20',
            '입춘' => '02-04', '우수' => '02-18',
            '경칩' => '03-05', '춘분' => '03-20',
            '청명' => '04-05', '곡우' => '04-20',
            '입하' => '05-05', '소만' => '05-21',
            '망종' => '06-06', '하지' => '06-21',
            '소서' => '07-07', '대서' => '07-23',
            '입추' => '08-07', '처서' => '08-23',
            '백로' => '09-08', '추분' => '09-23',
            '한로' => '10-08', '상강' => '10-24',
            '입동' => '11-08', '소설' => '11-22',
            '대설' => '12-07', '동지' => '12-22',
        ],
    ];

    /**
     * 절입일 기준 월별 절기 (월주 변경 기준이 되는 절)
     */
    public const MONTH_TERMS = [
        1 => '입춘',   // 인월(寅月)
        2 => '경칩',   // 묘월(卯月)
        3 => '청명',   // 진월(辰月)
        4 => '입하',   // 사월(巳月)
        5 => '망종',   // 오월(午月)
        6 => '소서',   // 미월(未月)
        7 => '입추',   // 신월(申月)
        8 => '백로',   // 유월(酉月)
        9 => '한로',   // 술월(戌月)
        10 => '입동',  // 해월(亥月)
        11 => '대설',  // 자월(子月)
        12 => '소한',  // 축월(丑月)
    ];

    /**
     * 일진 기준일
     * 2000년 1월 1일(토요일) = 갑진일(甲辰日)
     * stemIndex = 0 (갑), branchIndex = 4 (진)
     * 60갑자 인덱스 = 0 * 12 + 4 = 4 -> 계산법: (stemIndex * 6 + branchIndex) % 60...
     * 실제로는 일련번호로 계산
     */
    public const DAY_REFERENCE = [
        'date' => '2000-01-01',
        'stem_index' => 0,    // 갑(甲)
        'branch_index' => 4,  // 진(辰)
    ];

    /**
     * 월간 계산을 위한 년간별 시작 월간
     * 년간이 갑/기이면 월간 시작이 병(2)
     * 년간이 을/경이면 월간 시작이 무(4)
     * 년간이 병/신이면 월간 시작이 경(6)
     * 년간이 정/임이면 월간 시작이 임(8)
     * 년간이 무/계이면 월간 시작이 갑(0)
     */
    public const YEAR_MONTH_STEM_START = [
        0 => 2,  // 갑 -> 병인월
        1 => 4,  // 을 -> 무인월
        2 => 6,  // 병 -> 경인월
        3 => 8,  // 정 -> 임인월
        4 => 0,  // 무 -> 갑인월
        5 => 2,  // 기 -> 병인월
        6 => 4,  // 경 -> 무인월
        7 => 6,  // 신 -> 경인월
        8 => 8,  // 임 -> 임인월
        9 => 0,  // 계 -> 갑인월
    ];

    /**
     * 시간 계산을 위한 일간별 시작 시간
     * 일간이 갑/기이면 시간 시작이 갑(0)
     * 일간이 을/경이면 시간 시작이 병(2)
     * 일간이 병/신이면 시간 시작이 무(4)
     * 일간이 정/임이면 시간 시작이 경(6)
     * 일간이 무/계이면 시간 시작이 임(8)
     */
    public const DAY_HOUR_STEM_START = [
        0 => 0,  // 갑 -> 갑자시
        1 => 2,  // 을 -> 병자시
        2 => 4,  // 병 -> 무자시
        3 => 6,  // 정 -> 경자시
        4 => 8,  // 무 -> 임자시
        5 => 0,  // 기 -> 갑자시
        6 => 2,  // 경 -> 병자시
        7 => 4,  // 신 -> 무자시
        8 => 6,  // 임 -> 경자시
        9 => 8,  // 계 -> 임자시
    ];

    /**
     * 음력 데이터 (년도별)
     * 각 년도의 음력 월별 대소월 정보와 윤달 정보
     * 형식: [윤달월(없으면 0), 1월대소, 2월대소, ..., 12월대소] (1=대월30일, 0=소월29일)
     */
    public const LUNAR_DATA = [
        1900 => [8, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1], // 윤달 8월
        1901 => [0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0],
        1902 => [0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1],
        // ... 나머지 년도 데이터는 실제 만세력 데이터 필요
        // 여기서는 1920~2030년 데이터를 포함
        1970 => [0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0],
        1980 => [6, 0, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0],
        1990 => [5, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1],
        2000 => [4, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 1, 0],
        2020 => [4, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1],
        2021 => [0, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0],
        2022 => [0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0],
        2023 => [2, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1],
        2024 => [0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0],
        2025 => [6, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0],
        2026 => [0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1],
    ];

    /**
     * 지지 인덱스 가져오기
     */
    public static function getBranchIndex(string $branch): int
    {
        return array_search($branch, self::EARTHLY_BRANCHES);
    }

    /**
     * 천간 인덱스 가져오기
     */
    public static function getStemIndex(string $stem): int
    {
        return array_search($stem, self::HEAVENLY_STEMS);
    }
}
